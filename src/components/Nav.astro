---
import HeaderLink from "./HeaderLink.astro";
import { t } from "../i18n";

function currentLangPrefix() {
  const m = (Astro.url?.pathname || '').match(/^\/(es|en|fr)(\/|$)/);
  return m ? `/${m[1]}` : '';
}

const base = currentLangPrefix();
const lang = (base.replace('/', '') || 'es') as 'es'|'en'|'fr';
const links = [
  { href: `${base || "/"}`, label: t(lang, 'nav.home') },
  { href: `${base}/metadata`, label: t(lang, 'nav.metadata') },
  { href: `${base}/sets`, label: t(lang, 'nav.sets') },
];
---

<nav class="flex items-center gap-6 text-sm font-medium text-text-heading">
  <ul class="hidden items-center gap-6 border-l border-r border-border-ink/60 pl-6 pr-6 md:flex">
    {links.map((link, index) => (
      <li class="relative">
        {index > 0 && (
          <span class="absolute -left-4 top-1/2 hidden -translate-y-1/2 text-xs text-text-muted md:inline">//</span>
        )}
        <HeaderLink
          href={link.href}
          class="tracking-[0.35em] text-xs uppercase text-text-heading transition hover:text-text-body"
        >
          {link.label}
        </HeaderLink>
      </li>
    ))}
  </ul>

  <details class="group relative md:hidden">
    <summary class="flex cursor-pointer items-center gap-2 rounded-full border border-border-ink/60 bg-bg-card px-4 py-2 text-xs uppercase tracking-[0.3em] text-text-heading">
      {t(lang,'menu')}
      <span class="text-[0.6rem]">â–¾</span>
    </summary>
    <ul class="absolute left-1/2 -translate-x-1/2 right-auto mt-3 w-64 max-w-[90vw] space-y-1 rounded-2xl border border-border-ink bg-bg-card p-3 text-center shadow-[6px_6px_0_rgba(27,24,20,0.12)] z-50">
      {links.map((link) => (
        <li>
          <HeaderLink href={link.href} class="block rounded-lg px-3 py-2 text-sm text-text-heading hover:bg-bg-elevated">
            {link.label}
          </HeaderLink>
        </li>
      ))}
    </ul>
  </details>
</nav>
