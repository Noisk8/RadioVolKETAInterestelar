---
/*
  This is not a layout but just a component that's used in layouts.
*/
---

<script is:inline>
  // figure out user's preferred theme and set it as html class for tailwind before paint
  (function () {
    if (typeof window !== "undefined") {
      const isSystemColorSchemeDark = window.matchMedia(
        "(prefers-color-scheme: dark)"
      ).matches;
      // Prefer localStorage (persist across sessions). Migrate from sessionStorage if present.
      try {
        const legacy = sessionStorage.getItem("theme");
        if (legacy && !localStorage.getItem("theme")) {
          localStorage.setItem("theme", legacy);
          sessionStorage.removeItem("theme");
        }
      } catch {}

      const storageTheme = (() => {
        try { return localStorage.getItem("theme"); } catch { return null; }
      })();
      if (!storageTheme && isSystemColorSchemeDark) {
        document.documentElement.classList.add("dark");
        if (document.head.children.namedItem("theme-color")) {
          document.head.children.namedItem("theme-color").content = "#0f172a";
        }
      } else if (storageTheme === "dark") {
        document.documentElement.classList.add("dark");
        if (document.head.children.namedItem("theme-color")) {
          document.head.children.namedItem("theme-color").content = "#0f172a";
        }
      } else {
        // we already server render light theme
        if (document.head.children.namedItem("theme-color")) {
          document.head.children.namedItem("theme-color").content = "#ffffff";
        }
      }
    }
  })();
</script>
